<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kunden-Konfigurator ‚Äì Website Intake</title>



<!-- FAVICONS -->
<meta name="x-easter-egg" content="&#8203;&#8203;üöÄü™Ñ&#8203;&#8203;">
<link rel="icon" type="image/png" sizes="32x32" href="https://4rjn.github.io/sitebuilder/favicon-512.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://4rjn.github.io/sitebuilder/favicon-512.png">
<link rel="icon" type="image/png" sizes="512x512" href="https://4rjn.github.io/sitebuilder/favicon-512.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://4rjn.github.io/sitebuilder/favicon-512.png">

<!-- =========================
 SEO + Social Sharing (WhatsApp/FB/Twitter)
========================= -->
<meta name="description" content="Der vielleicht √ºbertriebenste Kunden-Konfigurator im Internet. SEO, Google, Intake & ein bisschen Wahnsinn.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://4rjn.github.io/sitebuilder/">

<meta property="og:type" content="website">
<meta property="og:site_name" content="Kunden-Konfigurator">
<meta property="og:title" content="üöÄ Dieser Konfigurator eskaliert komplett">
<meta property="og:description" content="SEO? Ja. Google Business? Ja. Seri√∂s? Vielleicht. Lustig? Definitiv.">
<meta property="og:url" content="https://4rjn.github.io/sitebuilder/">
<meta property="og:image" content="https://4rjn.github.io/sitebuilder/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="üöÄ Dieser Konfigurator eskaliert komplett">
<meta name="twitter:description" content="Ein Formular, das zu viel kann.">
<meta name="twitter:image" content="https://4rjn.github.io/sitebuilder/og-image.png">


  

<!-- Meta Extras -->
<meta name="theme-color" content="#0f172a">
<meta property="og:image:alt" content="Zu viel SEO f√ºr ein Formular ‚Äì 4RJN Sitebuilder">
<meta property="og:locale" content="de_DE">
<meta property="og:image:secure_url" content="https://4rjn.github.io/sitebuilder/og-image.png">
<meta property="og:updated_time" content="2026-01-28T22:46:38Z">

<!-- Optional: Animated OG (nicht √ºberall animiert, aber nice f√ºr Preview-Plattformen) -->
<meta property="og:image" content="https://4rjn.github.io/sitebuilder/og-image.gif">
<meta property="og:image:type" content="image/gif">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<style>
    :root{
      --bg:#ffffff;--fg:#0f172a;--muted:#475569;--card:#f8fafc;--border:#e2e8f0;
      --good:#16a34a;--bad:#dc2626;--warn:#b45309;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:16px;max-width:1100px;color:var(--fg);background:var(--bg)}
    h1{font-size:26px;margin:0 0 4px}
    p{color:var(--muted);line-height:1.55;margin:8px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px}
    .step{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
    .step .num{font-weight:900;background:#0f172a;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px}
    h2{margin:0 0 10px;font-size:18px}
    label{display:block;margin-top:10px;font-weight:800}
    input, textarea, select{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:12px;margin-top:6px;background:#fff}
    textarea{min-height:110px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){.row{grid-template-columns:1fr}}
    .hint{color:var(--muted);font-size:13px;margin-top:6px}
    .req{color:var(--bad)}
    .kpis{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .kpi{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fff}
    .kpi.good{border-color:#86efac}
    .kpi.bad{border-color:#fecaca}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{padding:12px 14px;border:0;border-radius:14px;cursor:pointer;font-weight:900}
    button.primary{background:#0f172a;color:#fff}
    button.secondary{background:#e2e8f0;color:#0f172a}
    button.danger{background:#fee2e2;color:#991b1b}
    button.small{padding:8px 10px;border-radius:12px;font-size:12px}
    .ok{color:var(--good);font-weight:900}
    .warn{color:var(--warn);font-weight:900}
    pre{background:#0b1220;color:#e5e7eb;border-radius:16px;padding:12px;overflow:auto;font-size:12px;min-height:120px;white-space:pre-wrap}
    details{background:#fff;border:1px solid var(--border);border-radius:14px;padding:10px;margin-top:10px}
    summary{cursor:pointer;font-weight:900}
    .svc{border:1px solid var(--border);background:#fff;border-radius:16px;padding:12px;margin-top:12px}
    .svc h3{margin:0}
    .svc .top{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
    .svc .tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .handle{cursor:grab;user-select:none;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:12px}
    .pill{font-size:12px;border:1px solid var(--border);border-radius:999px;padding:4px 8px;background:#fff}
    .divider{height:1px;background:var(--border);margin:14px 0}
  </style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Kunden-Konfigurator ‚Äì Website Intake (Sitebuilder)",
  "url": "https://4rjn.github.io/sitebuilder/",
  "applicationCategory": "BusinessApplication",
  "operatingSystem": "Web",
  "description": "Ein Web-Formular, das Website-Inhalte, SEO, Google Business und Services strukturiert einsammelt und als JSON/ZIP exportiert.",
  "author": {
    "@type": "Person",
    "name": "4RJN"
  },
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "EUR"
  },
  "softwareVersion": "1.0",
  "isAccessibleForFree": true
}
</script>
</head>
<body>
  <h1>Kunden-Konfigurator</h1>
  <p>
    Kunde f√ºllt online aus ‚Üí Export <b>intake.zip</b> ‚Üí du baust lokal die Website (<b>dist/</b>).
    Das Formular ist so aufgebaut, dass <b>Texte, Inhalte, SEO, Google Business & Rechtliches</b> nicht vergessen werden k√∂nnen.
  </p>
  <p class="hint">Pflichtfelder sind mit <span class="req">*</span> markiert. Export blockiert, wenn etwas fehlt.</p>

  <div class="grid">

    <div class="card">
      <div class="step"><span class="num">1</span><h2>Firmendaten & Kontakt</h2></div>

      <div class="row">
        <div>
          <label>Firmenname <span class="req">*</span></label>
          <input id="name" placeholder="Muster Reinigung GmbH">
        </div>
        <div>
          <label>Domain (ohne https) <span class="req">*</span></label>
          <input id="domain" placeholder="muster-reinigung.de">
          <div class="hint">Wird automatisch zu <b>https://DOMAIN</b>.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>E-Mail <span class="req">*</span></label>
          <input id="email" placeholder="info@muster-reinigung.de">
        </div>
        <div>
          <label>Telefon <span class="req">*</span></label>
          <input id="phone" placeholder="+49 89 123456">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Stra√üe + Nr. <span class="req">*</span></label>
          <input id="street" placeholder="Musterstra√üe 1">
        </div>
        <div>
          <label>PLZ <span class="req">*</span></label>
          <input id="zip" placeholder="80331">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Ort <span class="req">*</span></label>
          <input id="city" placeholder="M√ºnchen">
        </div>
        <div>
          <label>Google Maps URL</label>
          <input id="maps" placeholder="https://maps.app.goo.gl/...">
        </div>
      </div>

      <label>Service Areas (Orte, kommagetrennt)</label>
      <input id="areas" placeholder="M√ºnchen, Dachau, Umgebung">
      <div class="hint">Tipp: Orte aus deinem Einsatzgebiet. Wird strukturiert gespeichert.</div>

      <div class="divider"></div>

      <div class="step"><span class="num">2</span><h2>Startseite ‚Äì Inhalte</h2></div>

      <div class="row">
        <div>
          <label>Hero √úberschrift <span class="req">*</span></label>
          <input id="homeH1" placeholder="Geb√§udereinigung in M√ºnchen & Dachau">
        </div>
        <div>
          <label>Hero Unterzeile <span class="req">*</span></label>
          <input id="homeLead" placeholder="Zuverl√§ssig, gr√ºndlich, kurzfristig ‚Äì Angebot in 24 Stunden.">
        </div>
      </div>

      <label>Startseite ‚Äì Kurztext (1‚Äì2 Abs√§tze) <span class="req">*</span></label>
      <textarea id="homeIntro" placeholder="Beschreibe kurz: Was macht ihr? F√ºr wen? In welcher Region?"></textarea>

      <div class="row">
        <div>
          <label>CTA Button Text (Startseite)</label>
          <input id="homeCtaLabel" placeholder="Anfrage senden">
        </div>
        <div>
          <label>CTA Button Link (Startseite)</label>
          <input id="homeCtaHref" placeholder="#anfrage">
        </div>
      </div>

      <div class="hint">Diese Inhalte werden auf der Startseite sichtbar eingebaut.</div>
    </div>

    <div class="card">
      <div class="step"><span class="num">3</span><h2>SEO & Google Business</h2></div>

      <label>SEO Title (Startseite) <span class="req">*</span> <span class="hint">(empf. 50‚Äì60 Zeichen)</span></label>
      <input id="seoTitle" placeholder="Muster Reinigung GmbH ‚Äì Geb√§udereinigung in M√ºnchen">
      <div class="kpis"><span class="kpi" id="titleKpi"></span></div>

      <label>Meta Description (Startseite) <span class="req">*</span> <span class="hint">(empf. 150‚Äì160 Zeichen)</span></label>
      <textarea id="seoDesc" placeholder="Professionelle Geb√§udereinigung in M√ºnchen: B√ºro, Praxis, Treppenhaus, Glas. Angebot in 24h."></textarea>
      <div class="kpis"><span class="kpi" id="descKpi"></span></div>

      <label>Canonical (Startseite) <span class="req">*</span></label>
      <input id="canonical" placeholder="https://muster-reinigung.de/">

      <div class="divider"></div>

      <label>Google Business Kategorie <span class="req">*</span></label>
      <input id="gbpCategory" placeholder="Geb√§udereinigungsdienst">

      <label>Google Business Beschreibung <span class="hint">(empf. 250‚Äì750 Zeichen)</span></label>
      <textarea id="gbpDescription" placeholder="Kurz, klar, lokal. Leistungen + Einsatzgebiet + USP."></textarea>
      <div class="kpis"><span class="kpi" id="gbpDescKpi"></span><span class="pill">Empfehlung: 250‚Äì750 Zeichen</span></div>

      <details>
        <summary>Google Business Extras</summary>
        <div class="row">
          <div>
            <label>Attribute (je Zeile 1 Attribut)</label>
            <textarea id="gbpAttributes" placeholder="z.B. Kostenlose Beratung&#10;Notfallservice&#10;Rechnung m√∂glich"></textarea>
          </div>
          <div>
            <label>√ñffnungszeiten pro Wochentag</label>
            <div class="hint">Format: <b>08:00‚Äì18:00</b> (leer = geschlossen)</div>
            <div class="row">
              <div><label>Mo</label><input id="mon" placeholder="08:00‚Äì18:00"></div>
              <div><label>Di</label><input id="tue" placeholder="08:00‚Äì18:00"></div>
            </div>
            <div class="row">
              <div><label>Mi</label><input id="wed" placeholder="08:00‚Äì18:00"></div>
              <div><label>Do</label><input id="thu" placeholder="08:00‚Äì18:00"></div>
            </div>
            <div class="row">
              <div><label>Fr</label><input id="fri" placeholder="08:00‚Äì18:00"></div>
              <div><label>Sa</label><input id="sat" placeholder=""></div>
            </div>
            <div class="row">
              <div><label>So</label><input id="sun" placeholder=""></div>
              <div><label>Freitext (optional)</label><input id="hoursText" placeholder="Mo‚ÄìFr 08:00‚Äì18:00"></div>
            </div>
          </div>
        </div>
      </details>

      <div class="divider"></div>

      <div class="step"><span class="num">4</span><h2>Bilder (Uploads)</h2></div>

      <details open>
        <summary>Upload-Hinweise (Gr√∂√üen & Limits)</summary>
        <ul class="hint">
          <li><b>Logo:</b> SVG empfohlen, max 300 KB</li>
          <li><b>OG-Image:</b> 1200√ó630, max 500 KB</li>
          <li><b>Hero:</b> 1600√ó900, max 800 KB</li>
          <li><b>Service-Bild:</b> 1200√ó800 empfohlen, max 600 KB</li>
        </ul>
      </details>

      <div class="row">
        <div><label>Logo (SVG/PNG/WebP)</label><input id="fileLogo" type="file" accept=".svg,image/png,image/webp"></div>
        <div><label>OG-Image (1200√ó630)</label><input id="fileOg" type="file" accept="image/png,image/webp"></div>
      </div>
      <div class="row">
        <div><label>Hero-Bild (1600√ó900)</label><input id="fileHero" type="file" accept="image/webp,image/jpeg,image/png"></div>
        <div><label>Favicon (512√ó512)</label><input id="fileFavicon" type="file" accept="image/png,image/webp"></div>
      </div>

      <div class="divider"></div>

      <details>
        <summary>Seiten, Men√º & Rechtliches</summary>

        <div class="row">
          <div>
            <label>Men√º: Leistungen <span class="req">*</span></label>
            <input id="navServices" value="Leistungen">
          </div>
          <div>
            <label>Men√º: √úber uns <span class="req">*</span></label>
            <input id="navAbout" value="√úber uns">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Men√º: Kontakt <span class="req">*</span></label>
            <input id="navContact" value="Kontakt">
          </div>
          <div>
            <label>Men√º: FAQ</label>
            <input id="navFaq" value="FAQ">
          </div>
        </div>

        <details style="margin-top:10px">
          <summary>Men√º anzeigen / Seite bauen</summary>
          <p class="mini">‚ÄûSeite bauen‚Äú = Seite existiert + in Sitemap. ‚ÄûMen√º anzeigen‚Äú = Link sichtbar im Men√º/Footer.</p>

          <div class="row">
            <div>
              <label><input type="checkbox" id="buildServices" checked> Leistungen-Seite bauen</label>
              <label><input type="checkbox" id="showServices" checked> Leistungen im Men√º anzeigen</label>
            </div>
            <div>
              <label><input type="checkbox" id="buildAbout" checked> √úber uns Seite bauen</label>
              <label><input type="checkbox" id="showAbout" checked> √úber uns im Men√º anzeigen</label>
            </div>
          </div>

          <div class="row">
            <div>
              <label><input type="checkbox" id="buildContact" checked> Kontakt Seite bauen</label>
              <label><input type="checkbox" id="showContact" checked> Kontakt im Men√º anzeigen</label>
            </div>
            <div>
              <label><input type="checkbox" id="buildFaq" checked> FAQ Seite bauen</label>
              <label><input type="checkbox" id="showFaq" checked> FAQ im Men√º anzeigen (nur wenn FAQs existieren)</label>
            </div>
          </div>
        </details>

        <h3 style="margin:12px 0 6px">√úber uns ‚Äì Inhalte</h3>
        <div class="row">
          <div><label>SEO Title (√úber uns)</label><input id="aboutTitle" placeholder="√úber uns ‚Äì Muster Reinigung GmbH"></div>
          <div><label>Meta Description (√úber uns)</label><input id="aboutDesc" placeholder="Kurz, Vertrauen, Team, Werte."></div>
        </div>
        <label>Text (√úber uns)</label>
        <textarea id="aboutContent" placeholder="Beschreibe euer Unternehmen, Erfahrung, Werte, Team."></textarea>

        <h3 style="margin:12px 0 6px">Kontakt ‚Äì Inhalte</h3>
        <div class="row">
          <div><label>SEO Title (Kontakt)</label><input id="contactTitle" placeholder="Kontakt ‚Äì Muster Reinigung GmbH"></div>
          <div><label>Meta Description (Kontakt)</label><input id="contactDesc" placeholder="Angebot anfragen, R√ºckruf, Erreichbarkeit."></div>
        </div>
        <label>Text (Kontakt)</label>
        <textarea id="contactContent" placeholder="Wie erreicht man euch? Reaktionszeit? Angebot?"></textarea>

        <div class="row">
          <div><label>CTA Button Text (Kontakt)</label><input id="contactCtaLabel" placeholder="Anfrage senden"></div>
          <div><label>CTA Button Link (Kontakt)</label><input id="contactCtaHref" placeholder="#anfrage"></div>
        </div>

        <div class="row">
          <div><label>WhatsApp Nummer (optional)</label><input id="waNumber" placeholder="+491701234567"></div>
          <div><label>WhatsApp Startnachricht (optional)</label><input id="waMessage" placeholder="Hallo, ich h√§tte gerne ein Angebot..."></div>
        </div>

        <h3 style="margin:12px 0 6px">FAQ-Seite ‚Äì SEO</h3>
        <div class="row">
          <div><label>SEO Title (FAQ)</label><input id="faqTitle" placeholder="FAQ ‚Äì Muster Reinigung GmbH"></div>
          <div><label>Meta Description (FAQ)</label><input id="faqDesc" placeholder="Antworten auf h√§ufige Fragen rund um Reinigung & Angebot."></div>
        </div>

        <p class="hint"><b>Impressum/Datenschutz:</b> √ºbernehmen automatisch Firmen-/Kontaktdaten. Bitte rechtlich pr√ºfen lassen (Tools, Hosting, Tracking, Maps etc.).</p>
      </details>

      <div class="btns">
        <button class="secondary" id="downloadJson">customer.json herunterladen</button>
        <button class="primary" id="exportZip">‚úÖ Export intake.zip</button>
        <button class="secondary" id="copyJson">customer.json kopieren</button>
      </div>
      <div class="hint" id="status"></div>
    </div>
  </div>

  <div class="card" style="margin-top:14px">
    <div class="step"><span class="num">5</span><h2>Leistungen / Services</h2></div>
    <p class="hint">
      Hier tr√§gst du die Leistungen ein. F√ºr jede Leistung entsteht automatisch eine Unterseite inkl. SEO, Breadcrumb & FAQ Schema.
      <b>Mobile Hinweis:</b> Drag&Drop ist auf Smartphones oft eingeschr√§nkt ‚Äì nutze hier die <b>‚Üë / ‚Üì Buttons</b> zum Sortieren.
    </p>

    <div class="btns">
      <button class="primary" id="addService">‚ûï Service hinzuf√ºgen</button>
    </div>

    <div id="services"></div>
  </div>

  <div class="card" style="margin-top:14px">
    <div class="step"><span class="num">6</span><h2>Vorschau (customer.json)</h2></div>
    <pre id="preview"></pre>
  </div>

<script>

/* ===========================
   Secret Emoji Easter Egg
   Tipp: Tippe schnell "seo" (s-e-o) ‚Äì dann wird ein magisches Emoji in den Title gemogelt ü™Ñ
=========================== */
(() => {
  const secret = "\u200b\u200büöÄü™Ñ\u200b\u200b";
  let buf = "";
  let timer = null;
  window.addEventListener("keydown", (e) => {
    const k = (e.key || "").toLowerCase();
    if (!k || k.length !== 1) return;
    buf += k;
    clearTimeout(timer);
    timer = setTimeout(() => (buf = ""), 700);
    if (buf.endsWith("seo")) {
      document.title = document.title.replace(secret, "") + secret;
      buf = "";
    }
  });
})();

/* ===========================
   Utilities
=========================== */
const $ = (id) => document.getElementById(id);

const LIMITS = { logo: 300*1024, og: 500*1024, hero: 800*1024, favicon: 200*1024, serviceImg: 600*1024 };

function baseUrlFromDomain(domain){
  if(!domain) return "";
  if(domain.startsWith("http://") || domain.startsWith("https://")) return domain.replace(/\/$/,"");
  return ("https://" + domain).replace(/\/$/,"");
}

function slugify(s){
  return (s||"")
    .toLowerCase()
    .trim()
    .replace(/√§/g,"ae").replace(/√∂/g,"oe").replace(/√º/g,"ue").replace(/√ü/g,"ss")
    .replace(/[^a-z0-9\s-]/g,"")
    .replace(/\s+/g,"-")
    .replace(/-+/g,"-");
}

function setKpi(node, ok, text){
  node.textContent = text;
  node.className = "kpi " + (ok ? "good" : "bad");
}

function refreshKpis(){
  const t = ($("seoTitle").value||"").trim().length;
  setKpi($("titleKpi"), t>=45 && t<=65, `${t} Zeichen ¬∑ empf. 50‚Äì60`);
  const d = ($("seoDesc").value||"").trim().length;
  setKpi($("descKpi"), d>=120 && d<=170, `${d} Zeichen ¬∑ empf. 150‚Äì160`);
  const g = ($("gbpDescription").value||"").trim().length;
  const ok = (g===0) || (g>=250 && g<=750);
  setKpi($("gbpDescKpi"), ok, `${g} Zeichen ¬∑ empf. 250‚Äì750`);
}

function parseHoursRange(s){
  const m = (s||"").trim().match(/^\s*(\d{2}:\d{2})\s*[‚Äì-]\s*(\d{2}:\d{2})\s*$/);
  if(!m) return null;
  return {opens:m[1], closes:m[2]};
}

function openingHoursWeekly(){
  const ids = ["mon","tue","wed","thu","fri","sat","sun"];
  const out = {};
  for(const id of ids){
    const v = parseHoursRange($(id)?.value||"");
    if(v) out[id] = v;
  }
  return out;
}

function downloadBlob(filename, blob){
  // Robust for mobile: open a new tab as fallback if download attribute is blocked
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.rel = "noopener";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 2500);
}

function fileOk(file, maxBytes){
  if(!file) return {ok:true};
  if(file.size > maxBytes){
    return {ok:false, msg:`Datei zu gro√ü: ${(file.size/1024).toFixed(0)} KB (max ${(maxBytes/1024).toFixed(0)} KB)`};
  }
  return {ok:true};
}

/* ===========================
   Services UI
=========================== */
function servicesNodes(){
  return Array.from(document.querySelectorAll("[data-svc]"));
}

function moveCard(node, dir){
  const parent = node.parentNode;
  const cards = servicesNodes();
  const idx = cards.indexOf(node);
  if(idx === -1) return;
  const newIdx = idx + dir;
  if(newIdx < 0 || newIdx >= cards.length) return;
  if(dir < 0) parent.insertBefore(node, cards[newIdx]);
  else parent.insertBefore(node, cards[newIdx].nextSibling);
  refresh();
}

function addServiceCard(prefill){
  const id = String(Date.now()) + String(Math.random()).slice(2,6);
  const wrap = document.createElement("div");
  wrap.className = "svc";
  wrap.setAttribute("data-svc", id);

  wrap.innerHTML = `
    <div class="top">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="handle" title="Desktop: Drag&Drop (Mobile: nutze ‚Üë/‚Üì)">‚†ø</span>
        <h3>Service</h3>
      </div>
      <div class="tools">
        <button class="secondary small" type="button" data-up="${id}">‚Üë</button>
        <button class="secondary small" type="button" data-down="${id}">‚Üì</button>
        <button class="danger small" type="button" data-remove="${id}">Entfernen</button>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Service-Name <span class="req">*</span></label>
        <input data-name="${id}" placeholder="z.B. B√ºro- und Praxisreinigung">
        <div class="hint">URL wird automatisch: <b>leistungen-&lt;slug&gt;.html</b></div>
      </div>
      <div>
        <label>Men√º-/Karten-Label (optional)</label>
        <input data-menulabel="${id}" placeholder="z.B. B√ºroreinigung">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Service-Bild (optional) <span class="hint">(1200√ó800 empfohlen, WebP/PNG/JPG, max 600 KB)</span></label>
        <input data-img="${id}" type="file" accept="image/webp,image/png,image/jpeg">
      </div>
      <div>
        <label>Kurz-Teaser (Karte) <span class="hint">(1 Satz)</span></label>
        <input data-snippet="${id}" placeholder="Gr√ºndlich, diskret und zuverl√§ssig ‚Äì Angebot in 24h.">
      </div>
    </div>

    <label>Lead-Text (oben auf Unterseite) <span class="hint">(2‚Äì3 S√§tze)</span></label>
    <input data-lead="${id}" placeholder="Wir reinigen gr√ºndlich und zuverl√§ssig ‚Äì feste Intervalle oder einmalig.">

    <label>Unterseiten-Content (optional) <span class="hint">(Abs√§tze, Ablauf, Vorteile)</span></label>
    <textarea data-content="${id}" placeholder="Ablauf, Leistungen, Intervalle, Besonderheiten..."></textarea>

    <details open>
      <summary>SEO & FAQ (f√ºr Google)</summary>

      <div class="row">
        <div>
          <label>SEO Title (optional)</label>
          <input data-seotitle="${id}" placeholder="z.B. B√ºroreinigung M√ºnchen ‚Äì Muster Reinigung GmbH">
        </div>
        <div>
          <label>Meta Description (optional)</label>
          <input data-seodesc="${id}" placeholder="Empf. 150‚Äì160 Zeichen.">
        </div>
      </div>

      <p class="hint"><b>FAQ:</b> Diese Fragen erscheinen auf der Service-Unterseite und werden zus√§tzlich in der globalen FAQ-Seite gesammelt.</p>

      <div class="row">
        <div><label>FAQ Frage 1</label><input data-faq1q="${id}" placeholder="Wie schnell bekommen wir ein Angebot?"></div>
        <div><label>FAQ Antwort 1</label><input data-faq1a="${id}" placeholder="In der Regel innerhalb von 24 Stunden."></div>
      </div>
      <div class="row">
        <div><label>FAQ Frage 2</label><input data-faq2q="${id}" placeholder="Bieten Sie feste Intervalle an?"></div>
        <div><label>FAQ Antwort 2</label><input data-faq2a="${id}" placeholder="Ja ‚Äì w√∂chentlich, 14-t√§gig oder nach Bedarf."></div>
      </div>
      <div class="row">
        <div><label>FAQ Frage 3</label><input data-faq3q="${id}" placeholder="Bringen Sie Reinigungsmittel mit?"></div>
        <div><label>FAQ Antwort 3</label><input data-faq3a="${id}" placeholder="Ja, auf Wunsch inkl. Material."></div>
      </div>
    </details>
  `;

  $("services").appendChild(wrap);

  // events
  wrap.querySelectorAll("input,textarea").forEach(el => el.addEventListener("input", refresh));
  wrap.querySelector(`[data-remove="${id}"]`).addEventListener("click", ()=>{ wrap.remove(); refresh(); });
  wrap.querySelector(`[data-up="${id}"]`).addEventListener("click", ()=> moveCard(wrap, -1));
  wrap.querySelector(`[data-down="${id}"]`).addEventListener("click", ()=> moveCard(wrap, +1));

  // optional prefill
  if(prefill){
    for(const [k,v] of Object.entries(prefill)){
      const el = wrap.querySelector(`[data-${k}="${id}"]`);
      if(el) el.value = v;
    }
  }

  refresh();
}

function buildServices(){
  const items = [];
  for(const node of servicesNodes()){
    const id = node.getAttribute("data-svc");
    const name = node.querySelector(`[data-name="${id}"]`).value.trim();
    if(!name) continue;

    const menuLabel = node.querySelector(`[data-menulabel="${id}"]`).value.trim();
    const lead = node.querySelector(`[data-lead="${id}"]`).value.trim();
    const snippet = node.querySelector(`[data-snippet="${id}"]`).value.trim();
    const content = node.querySelector(`[data-content="${id}"]`).value.trim();

    const seoTitle = node.querySelector(`[data-seotitle="${id}"]`).value.trim();
    const seoDesc = node.querySelector(`[data-seodesc="${id}"]`).value.trim();

    const faq = [];
    for(let i=1;i<=3;i++){
      const q = node.querySelector(`[data-faq${i}q="${id}"]`).value.trim();
      const a = node.querySelector(`[data-faq${i}a="${id}"]`).value.trim();
      if(q && a) faq.push({q,a});
    }

    const slug = slugify(name);
    const url = `leistungen-${slug}.html`;

    const imgInput = node.querySelector(`[data-img="${id}"]`);
    const imgFile = imgInput && imgInput.files && imgInput.files[0] ? imgInput.files[0] : null;

    items.push({ id, name, menuLabel: menuLabel || name, slug, url, lead, snippet, content, faq, imgFile });
  }
  return items;
}

/* ===========================
   Build customer.json
=========================== */
function buildConfig(){
  const domain = ($("domain").value||"").trim();
  const baseUrl = baseUrlFromDomain(domain);
  const canonical = ($("canonical").value||"").trim() || (baseUrl ? baseUrl + "/" : "");
  const mapsUrl = ($("maps").value||"").trim();
  const areas = ($("areas").value||"").trim();

  const services = buildServices();

  const cfg = {
    brand: {
      name: ($("name").value||"").trim(),
      domain: domain.replace(/^https?:\/\//,"").replace(/\/$/,""),
      baseUrl,
      logoPath: "/assets/img/logo.svg",
      ogImagePath: "/assets/img/og-image.png",
      sameAs: mapsUrl ? [mapsUrl] : []
    },
    contact: {
      email: ($("email").value||"").trim(),
      phone: ($("phone").value||"").trim()
    },
    address: {
      street: ($("street").value||"").trim(),
      zip: ($("zip").value||"").trim(),
      city: ($("city").value||"").trim(),
      country: "DE"
    },
    navigation: {
      labels: {
        services: ($("navServices").value||"Leistungen").trim(),
        about: ($("navAbout").value||"√úber uns").trim(),
        contact: ($("navContact").value||"Kontakt").trim(),
        faq: ($("navFaq").value||"FAQ").trim()
      },
      show: {
        services: $("showServices").checked,
        about: $("showAbout").checked,
        contact: $("showContact").checked,
        faq: $("showFaq").checked
      },
      build: {
        services: $("buildServices").checked,
        about: $("buildAbout").checked,
        contact: $("buildContact").checked,
        faq: $("buildFaq").checked
      }
    },
    gbp: {
      category: ($("gbpCategory").value||"").trim(),
      description: ($("gbpDescription").value||"").trim(),
      mapsUrl: mapsUrl || "",
      areasServed: areas ? areas.split(",").map(s=>s.trim()).filter(Boolean) : [],
      attributes: ($("gbpAttributes").value || "").split("\n").map(s=>s.trim()).filter(Boolean),
      openingHoursWeekly: openingHoursWeekly(),
      openingHoursText: ($("hoursText").value||"").trim()
    },
    schema: { type: "LocalBusiness" },

    home: {
      h1: ($("homeH1").value||"").trim(),
      lead: ($("homeLead").value||"").trim(),
      intro: ($("homeIntro").value||"").trim().replace(/\n/g,"<br>"),
      cta: { label: ($("homeCtaLabel").value||"").trim(), href: ($("homeCtaHref").value||"").trim() }
    },

    services: [],
    about: { content: ($("aboutContent").value||"").trim().replace(/\n/g,"<br>") },
    contactPage: {
      content: ($("contactContent").value||"").trim().replace(/\n/g,"<br>"),
      cta: { label: ($("contactCtaLabel").value||"").trim(), href: ($("contactCtaHref").value||"").trim() },
      whatsapp: { number: ($("waNumber").value||"").trim(), message: ($("waMessage").value||"").trim() }
    },
    pages: {},
    i18n: { lang: "de" }
  };

  // Pages
  cfg.pages["index.njk"] = {
    out:"index.html",
    title: ($("seoTitle").value||"").trim(),
    description: ($("seoDesc").value||"").trim(),
    canonical: canonical
  };

  if ($("buildServices").checked) {
    cfg.pages["leistungen.njk"] = {
      out:"leistungen.html",
      title: `${cfg.navigation.labels.services} ‚Äì ${cfg.brand.name}`,
      description: `Leistungen von ${cfg.brand.name} in ${cfg.address.city} & Umgebung. Jetzt Angebot anfragen.`,
      canonical: `${cfg.brand.baseUrl}/leistungen.html`
    };
  } else {
    cfg.navigation.show.services = false;
  }

  if ($("buildAbout").checked) {
    cfg.pages["about-page.njk"] = {
      template:"about-page.njk",
      out:"ueber-uns.html",
      title: ($("aboutTitle").value.trim() || `${cfg.navigation.labels.about} ‚Äì ${cfg.brand.name}`),
      description: ($("aboutDesc").value.trim() || `Erfahre mehr √ºber ${cfg.brand.name} ‚Äì Qualit√§t, Zuverl√§ssigkeit und Service in ${cfg.address.city}.`),
      canonical: `${cfg.brand.baseUrl}/ueber-uns.html`
    };
  } else {
    cfg.navigation.show.about = false;
  }

  if ($("buildContact").checked) {
    cfg.pages["contact-page.njk"] = {
      template:"contact-page.njk",
      out:"kontakt.html",
      title: ($("contactTitle").value.trim() || `${cfg.navigation.labels.contact} ‚Äì ${cfg.brand.name}`),
      description: ($("contactDesc").value.trim() || `Kontakt zu ${cfg.brand.name}: Angebot anfragen, R√ºckruf erhalten, schnell erreichbar.`),
      canonical: `${cfg.brand.baseUrl}/kontakt.html`
    };
  } else {
    cfg.navigation.show.contact = false;
  }

  if ($("buildFaq").checked) {
    cfg.pages["faq.njk"] = {
      template:"faq.njk",
      out:"faq.html",
      title: ($("faqTitle").value.trim() || `${cfg.navigation.labels.faq} ‚Äì ${cfg.brand.name}`),
      description: ($("faqDesc").value.trim() || `Antworten auf h√§ufige Fragen zu Leistungen, Ablauf und Angebot von ${cfg.brand.name}.`),
      canonical: `${cfg.brand.baseUrl}/faq.html`,
      _faqAll: true
    };
  } else {
    cfg.navigation.show.faq = false;
  }

  // Service pages
  for(const s of services){
    cfg.services.push({
      name: s.name,
      menuLabel: s.menuLabel,
      slug: s.slug,
      url: s.url,
      lead: s.lead,
      snippet: s.snippet,
      content: s.content ? s.content.replace(/\n/g,"<br>") : "",
      faq: s.faq,
      image: null,
      cardImage: null
    });

    cfg.pages[`service-page.njk::${s.slug}`] = {
      template: "service-page.njk",
      out: s.url,
      title: s.seoTitle || `${s.name} ‚Äì ${cfg.address.city} | ${cfg.brand.name}`,
      description: s.seoDesc || `Professionelle ${s.name} in ${cfg.address.city} & Umgebung. Angebot in 24h ‚Äì jetzt anfragen.`,
      canonical: `${cfg.brand.baseUrl}/${s.url}`,
      _serviceSlug: s.slug
    };
  }

  return {cfg, services};
}

function validateConfig(cfg){
  const missing = [];

  // Support keys that contain dots, e.g. cfg.pages["index.njk"]
  const getPath = (root, path) => {
    const parts = path.split(".");
    let cur = root;

    for (let i = 0; i < parts.length; i++) {
      if (cur == null) return null;

      const k = parts[i];

      // direct hit
      if (typeof cur === "object" && Object.prototype.hasOwnProperty.call(cur, k)) {
        cur = cur[k];
        continue;
      }

      // dot-key join (e.g. "index" + "." + "njk" => "index.njk")
      if (typeof cur === "object" && i + 1 < parts.length) {
        const joined = k + "." + parts[i + 1];
        if (Object.prototype.hasOwnProperty.call(cur, joined)) {
          cur = cur[joined];
          i++; // skip next part
          continue;
        }
      }

      return null;
    }
    return cur;
  };

  const must = (p) => {
    const v = getPath(cfg, p);
    if (v === null || v === undefined || v === "") missing.push(p);
  };

  [
    "brand.name","brand.domain","brand.baseUrl",
    "contact.email","contact.phone",
    "address.street","address.zip","address.city",
    "gbp.category",
    "home.h1","home.lead","home.intro",
    "pages.index.njk.title","pages.index.njk.description","pages.index.njk.canonical"
  ].forEach(must);

  return {missing};
}

/* ===========================
   ZIP builder (no external libs)
   - STORE method (no compression)
=========================== */
function u16(n){ return new Uint8Array([n & 255, (n>>>8) & 255]); }
function u32(n){ return new Uint8Array([n & 255, (n>>>8) & 255, (n>>>16) & 255, (n>>>24) & 255]); }

const crcTable = (() => {
  let c; const table = new Uint32Array(256);
  for (let n = 0; n < 256; n++) {
    c = n;
    for (let k = 0; k < 8; k++) c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));
    table[n] = c >>> 0;
  }
  return table;
})();
function crc32(buf){
  let crc = 0 ^ (-1);
  for(let i=0;i<buf.length;i++){
    crc = (crc >>> 8) ^ crcTable[(crc ^ buf[i]) & 0xFF];
  }
  return (crc ^ (-1)) >>> 0;
}
function strBytes(s){
  return new TextEncoder().encode(s);
}
function concat(chunks){
  const len = chunks.reduce((a,c)=>a+c.length,0);
  const out = new Uint8Array(len);
  let o=0;
  for(const c of chunks){ out.set(c,o); o+=c.length; }
  return out;
}
function zipStore(files){
  // files: [{name, data(Uint8Array)}]
  const localParts = [];
  const centralParts = [];
  let offset = 0;

  for(const f of files){
    const nameBytes = strBytes(f.name);
    const data = f.data;
    const crc = crc32(data);

    // Local file header
    const local = concat([
      u32(0x04034b50), // signature
      u16(20), // version
      u16(0), // flags
      u16(0), // method STORE
      u16(0), // time
      u16(0), // date
      u32(crc),
      u32(data.length),
      u32(data.length),
      u16(nameBytes.length),
      u16(0),
      nameBytes,
      data
    ]);
    localParts.push(local);

    // Central directory header
    const central = concat([
      u32(0x02014b50),
      u16(20), // version made by
      u16(20), // version needed
      u16(0),
      u16(0),
      u16(0),
      u16(0),
      u32(crc),
      u32(data.length),
      u32(data.length),
      u16(nameBytes.length),
      u16(0), // extra
      u16(0), // comment
      u16(0), // disk
      u16(0), // int attrs
      u32(0), // ext attrs
      u32(offset),
      nameBytes
    ]);
    centralParts.push(central);

    offset += local.length;
  }

  const centralDir = concat(centralParts);
  const end = concat([
    u32(0x06054b50),
    u16(0),
    u16(0),
    u16(files.length),
    u16(files.length),
    u32(centralDir.length),
    u32(offset),
    u16(0)
  ]);

  return concat([...localParts, centralDir, end]);
}

/* ===========================
   Export / Preview
=========================== */
function refresh(){
  try{
    const {cfg} = buildConfig();
    $("preview").textContent = JSON.stringify(cfg, null, 2);
    refreshKpis();
  }catch(e){
    $("preview").textContent = "‚ö†Ô∏è Fehler in Formular-Logik: " + (e?.message || e);
  }
}

function syncBuildToggles(){
  if(!$("buildServices") || !$("showServices")) return;
  if(!$("buildServices").checked) $("showServices").checked = false;
  if(!$("buildAbout").checked) $("showAbout").checked = false;
  if(!$("buildContact").checked) $("showContact").checked = false;
  if(!$("buildFaq").checked) $("showFaq").checked = false;
}

["buildServices","buildAbout","buildContact","buildFaq"].forEach(id=>{
  const el = $(id);
  if(el) el.addEventListener("change", ()=>{ syncBuildToggles(); refresh(); });
});

document.querySelectorAll("input,textarea,select").forEach(el => el.addEventListener("input", refresh));

$("addService").addEventListener("click", ()=> addServiceCard());

$("downloadJson").addEventListener("click", ()=>{
  const {cfg} = buildConfig();
  const blob = new Blob([JSON.stringify(cfg, null, 2)], {type:"application/json"});
  downloadBlob("customer.json", blob);
});

$("copyJson").addEventListener("click", async ()=>{
  const {cfg} = buildConfig();
  const txt = JSON.stringify(cfg, null, 2);
  try{
    await navigator.clipboard.writeText(txt);
    $("status").innerHTML = '<span class="ok">customer.json kopiert.</span>';
  }catch(e){
    $("status").innerHTML = '<span class="warn">Clipboard nicht verf√ºgbar ‚Äì nutze Download.</span>';
  }
});

$("exportZip").addEventListener("click", async ()=>{
  const status = $("status");
  status.textContent = "";

  const {cfg, services} = buildConfig();
  const {missing} = validateConfig(cfg);
  if(missing.length){
    status.innerHTML = `<span class="warn">Bitte Pflichtfelder ausf√ºllen:</span><br>` + missing.map(m=>`‚Ä¢ ${m}`).join("<br>");
    return;
  }

  // size checks
  const logo = $("fileLogo").files[0];
  const og = $("fileOg").files[0];
  const hero = $("fileHero").files[0];
  const fav = $("fileFavicon").files[0];

  const checks = [];
  if(logo) checks.push(fileOk(logo, LIMITS.logo));
  if(og) checks.push(fileOk(og, LIMITS.og));
  if(hero) checks.push(fileOk(hero, LIMITS.hero));
  if(fav) checks.push(fileOk(fav, LIMITS.favicon));
  for(const s of services){
    if(s.imgFile) checks.push(fileOk(s.imgFile, LIMITS.serviceImg));
  }
  const bad = checks.find(c=>!c.ok);
  if(bad){ status.innerHTML = `<span class="warn">${bad.msg}</span>`; return; }

  // Prepare files for zip
  const files = [];

  // customer.json first
  const custBytes = new TextEncoder().encode(JSON.stringify(cfg, null, 2));
  files.push({ name: "customer.json", data: custBytes });

  // uploaded assets
  async function addFile(path, file){
    const buf = new Uint8Array(await file.arrayBuffer());
    files.push({ name: path, data: buf });
  }

  // global assets
  if(logo){
    const ext = logo.name.toLowerCase().endsWith(".svg") ? "svg" : (logo.type.includes("webp") ? "webp" : "png");
    await addFile(`assets/img/logo.${ext}`, logo);
  }
  if(og){
    const ext = og.type.includes("webp") ? "webp" : "png";
    await addFile(`assets/img/og-image.${ext}`, og);
  }
  if(hero){
    const ext = hero.type.includes("webp") ? "webp" : (hero.type.includes("png") ? "png" : "jpg");
    await addFile(`assets/img/hero-cleaning.${ext}`, hero);
  }
  if(fav){
    const ext = fav.type.includes("webp") ? "webp" : "png";
    await addFile(`assets/img/favicon.${ext}`, fav);
  }

  // per service images
  for(const s of services){
    if(!s.imgFile) continue;
    const ext = s.imgFile.type.includes("webp") ? "webp" : (s.imgFile.type.includes("png") ? "png" : "jpg");
    await addFile(`assets/img/services/${s.slug}.${ext}`, s.imgFile);

    // update cfg paths to match ext
    const svc = cfg.services.find(x => x.slug === s.slug);
    if(svc){
      svc.image = `/assets/img/services/${s.slug}.${ext}`;
      svc.cardImage = `/assets/img/services/${s.slug}.${ext}`;
    }
  }

  // overwrite customer.json with updated paths
  files[0].data = new TextEncoder().encode(JSON.stringify(cfg, null, 2));

  // README for intake
  files.push({ name: "README.txt", data: new TextEncoder().encode(
`Website Intake Export
====================
Enth√§lt:
- customer.json (Texte, SEO, Services, FAQs, Google Business, Men√º/Seiten-Schalter)
- assets/img/... (Uploads inkl. services/<slug>.<ext>)

Build (lokal):
npm install
npm run build -- --intake intake.zip
`)});

  const zipBytes = zipStore(files);
  const blob = new Blob([zipBytes], {type:"application/zip"});
  downloadBlob("intake.zip", blob);
  status.innerHTML = `<span class="ok">Export fertig.</span>`;
});

/* ===========================
   Init (Demo-Services, damit UI sichtbar ist)
=========================== */
function initDemo(){
  if(servicesNodes().length) return;
  addServiceCard({name:"B√ºro- und Praxisreinigung", menulabel:"B√ºro & Praxis", snippet:"Gr√ºndlich, diskret und zuverl√§ssig ‚Äì Angebot in 24h."});
  addServiceCard({name:"Glas- und Fensterreinigung", menulabel:"Glasreinigung", snippet:"Streifenfrei, regelm√§√üig oder einmalig ‚Äì innen & au√üen."});
  addServiceCard({name:"Treppenhausreinigung", menulabel:"Treppenhaus", snippet:"Saubere Eing√§nge f√ºr Mieter & Besucher ‚Äì feste Intervalle."});
}

// Defaults for home fields to avoid empty preview
$("homeH1").value = $("homeH1").value || "Geb√§udereinigung in M√ºnchen & Umgebung";
$("homeLead").value = $("homeLead").value || "Zuverl√§ssig, gr√ºndlich und flexibel ‚Äì Angebot in 24 Stunden.";
$("homeIntro").value = $("homeIntro").value || "Wir reinigen B√ºros, Praxen, Treppenh√§user und Glasfl√§chen in M√ºnchen, Dachau und Umgebung. Sauber, termintreu und transparent ‚Äì mit festen Intervallen oder einmalig.";
$("homeCtaLabel").value = $("homeCtaLabel").value || "Anfrage senden";
$("homeCtaHref").value = $("homeCtaHref").value || "#anfrage";

syncBuildToggles();
initDemo();
refresh();
</script>
</body>
</html>
